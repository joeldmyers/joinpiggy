var app={supplies_id:null,tag:"",loadRequirements:function(){$.getJSON(_basePath+"/supplies/"+this.supplies_id+"/requirements.json",function(t){for(var e=$("#requirements-template").html(),a=Handlebars.compile(e),r=0;r<t.length;r++){var i=t[r]
$("#requirements tbody").append(a(i))}$("#requirements a").on("click",function(t){t.preventDefault(),app.loadProducts($(this).attr("data-requirement-id"))})})},loadProducts:function(t){$.getJSON(_basePath+"/supplies/"+this.supplies_id+"/requirements/"+t+"/products.json",function(t){var e=$("#products-template").html(),a=Handlebars.compile(e)
$(".products").html("")
for(var r=0;r<t.length;r++){var i=t[r]
$(".products").append(a(i))}$(".products button").on("click",function(t){t.preventDefault(),app.addToCart($(this))})})},addToCart:function(t){return $('#cart .row[data-product-id="'+t.attr("data-product-id")+'"]').length?(alert("You've already added that!"),!1):void $.ajax({url:_basePath+"/supplies/"+this.supplies_id+"/cart",data:{product_id:t.attr("data-product-id"),requirement_id:t.attr("data-requirement-id")},dataType:"json",context:t,type:"POST",success:function(t){var e=$("#cart-template").html(),a=Handlebars.compile(e),r={cart_id:t.id,product_id:this.attr("data-product-id"),requirement_id:this.attr("data-requirement-id"),image:this.attr("data-image"),title:this.attr("data-title"),price:parseFloat(this.attr("data-price")),url:this.attr("data-url"),asin:this.attr("data-asin"),qty:this.attr("data-qty")};-1!==$("#cart").html().indexOf("Nothing here yet")&&$("#cart").html(""),$("#cart").prepend(a(r)),$("#checkoutButton").show(),$("#checkoutButton").off("click").on("click",function(t){t.preventDefault()
var e="http://www.amazon.com/gp/aws/cart/add.html?AssociateTag="+app.tag,a=0
$("#cart .row").each(function(){a++,e+="&ASIN."+a+"="+$(this).attr("data-asin")+"&Quantity."+a+"=1"}),window.open(e)}),app.checkQuantities(this.attr("data-requirement-id")),$("#cart button").off("click").on("click",function(t){t.preventDefault(),app.removeFromCart($(this))})}})},removeFromCart:function(t){$.ajax({url:_basePath+"/supplies/"+this.supplies_id+"/cart",context:t,data:{id:t.attr("data-id")},dataType:"json",type:"DELETE",success:function(t){var e=$('#cart .row[data-id="'+t.id+'"]').attr("data-requirement-id")
return e?($('#cart .row[data-id="'+t.id+'"]').remove(),0==$("#cart .row").length&&($("#checkoutButton").hide(),$("#cart").html("<p>Nothing here yet</p>")),void app.checkQuantities(e)):!1}})},checkQuantities:function(t){var e=$('#requirements a[data-requirement-id="'+t+'"]').attr("data-qty-required"),a=0
$('#cart .row[data-requirement-id="'+t+'"]').each(function(){a+=parseInt($(this).attr("data-qty"))}),a>=e?$('#requirements tr[data-requirement-id="'+t+'"] input[type="checkbox"]').prop("checked",!0):$('#requirements tr[data-requirement-id="'+t+'"] input[type="checkbox"]').prop("checked",!1)},init:function(t,e){this.supplies_id=t,this.tag=e,this.loadRequirements(),""==$("#cart").html().trim()?$("#cart").html("<p>Nothing here yet</p>"):$("#cart button").on("click",function(t){t.preventDefault(),app.removeFromCart($(this))})}}
Handlebars.registerHelper("toFixed",function(t){return"number"==typeof t?t.toFixed(2):new Number(t).toFixed(2)})
