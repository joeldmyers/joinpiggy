/* Add to Homescreen v3.0.7 ~ (c) 2014 Matteo Spinelli ~ @license: http://cubiq.org/license */
!function(t,e){function i(){t.removeEventListener("load",i,!1),a=!0}function s(t){return r=r||new s.Class(t)}function o(t,e){for(var i in e)t[i]=e[i]
return t}function n(){"#ath"==e.location.hash&&history.replaceState("",t.document.title,e.location.href.split("#")[0]),h.test(e.location.href)&&history.replaceState("",t.document.title,e.location.href.replace(h,"$1")),l.test(e.location.search)&&history.replaceState("",t.document.title,e.location.href.replace(l,"$2"))}var a=!1
"complete"===e.readyState?a=!0:t.addEventListener("load",i,!1)
var r,h=/\/ath(\/)?$/,l=/([\?&]ath=[^&]*$|&ath=[^&]*(&))/
s.intl={de_de:{message:"Um diese Web-App zum Home-Bildschirm hinzuzufügen, tippen Sie auf %icon und dann <strong>%action</strong>.",action:{ios:"Zum Home-Bildschirm",android:"Zum Startbildschirm hinzufügen",windows:"Auf Startseite"}},en_us:{message:"To add this web app to the home screen: tap %icon and then <strong>%action</strong>.",action:{ios:"Add to Home Screen",android:"Add to homescreen",windows:"pin to start"}},es_es:{message:"Para añadir esta aplicación web a la pantalla de inicio: pulsa %icon y selecciona <strong>%action</strong>.",action:{ios:"Añadir a pantalla de inicio",android:"Añadir a pantalla de inicio",windows:"Añadir a inicio"}},fr_fr:{message:"Pour ajouter cette application web sur l'écran d'accueil : Appuyez %icon et sélectionnez <strong>%action</strong>.",action:{ios:"Ajouter sur l'écran d'accueil",android:"Ajouter à l'écran d'accueil",windows:"Épingler à l'écran d'accueil"}},it_it:{message:"Per Aggiungere questa web app alla schermata iniziale: premi %icon e poi <strong>%action</strong>.",action:{ios:"Aggiungi a Home",android:"Aggiungi alla homescreen",windows:"aggiungi a start"}},nb_no:{message:"For å installere denne appen på hjem-skjermen: trykk på %icon og deretter <strong>%action</strong>.",action:{ios:"Legg til på Hjem-skjerm",android:"Legg til på startsiden",windows:"fest til start"}},nl_nl:{message:"Om deze webapp op je telefoon te installeren, klik op %icon en dan <strong>%action</strong>.",action:{ios:"Voeg toe aan beginscherm",android:"Toevoegen aan startscherm",windows:"Aan startscherm vastmaken"}},sv_se:{message:"För att lägga till denna webbapplikation på hemskärmen: tryck på %icon och därefter <strong>%action</strong>.",action:{ios:"Lägg till på hemskärmen",android:"Lägg til på startskärmen",windows:"fäst på startskärmen"}},zh_cn:{message:"如要把应用程式加至主屏幕,请点击%icon, 然后<strong>%action</strong>",action:{ios:"加至主屏幕",android:"加至主屏幕",windows:"按住启动"}},zh_tw:{message:"如要把應用程式加至主屏幕, 請點擊%icon, 然後<strong>%action</strong>.",action:{ios:"加至主屏幕",android:"加至主屏幕",windows:"按住啟動"}}}
for(var d in s.intl)s.intl[d.substr(0,2)]=s.intl[d]
s.defaults={appID:"org.cubiq.addtohome",fontSize:15,debug:!1,modal:!1,mandatory:!1,autostart:!0,skipFirstVisit:!1,startDelay:1,lifespan:15,displayPace:1440,maxDisplayCount:0,icon:!0,message:"",validLocation:[],onInit:null,onShow:null,onRemove:null,onAdd:null,onPrivate:null,detectHomescreen:!1}
var c=t.navigator.userAgent,p=t.navigator
o(s,{hasToken:"#ath"==e.location.hash||h.test(e.location.href)||l.test(e.location.search),isRetina:t.devicePixelRatio&&t.devicePixelRatio>1,isIDevice:/iphone|ipod|ipad/i.test(c),isMobileChrome:c.indexOf("Android")>-1&&/Chrome\/[.0-9]*/.test(c),isMobileIE:c.indexOf("Windows Phone")>-1,language:p.language&&p.language.toLowerCase().replace("-","_")||""}),s.language=s.language&&s.language in s.intl?s.language:"en_us",s.isMobileSafari=s.isIDevice&&c.indexOf("Safari")>-1&&c.indexOf("CriOS")<0,s.OS=s.isIDevice?"ios":s.isMobileChrome?"android":s.isMobileIE?"windows":"unsupported",s.OSVersion=c.match(/(OS|Android) (\d+[_\.]\d+)/),s.OSVersion=s.OSVersion&&s.OSVersion[2]?+s.OSVersion[2].replace("_","."):0,s.isStandalone=t.navigator.standalone||s.isMobileChrome&&screen.height-e.documentElement.clientHeight<40,s.isTablet=s.isMobileSafari&&c.indexOf("iPad")>-1||s.isMobileChrome&&c.indexOf("Mobile")<0,s.isCompatible=s.isMobileSafari&&s.OSVersion>=6||s.isMobileChrome
var m={lastDisplayTime:0,returningVisitor:!1,displayCount:0,optedout:!1,added:!1}
s.removeSession=function(t){try{localStorage.removeItem(t||s.defaults.appID)}catch(e){}},s.Class=function(i){if(this.options=o({},s.defaults),o(this.options,i),this.options.mandatory=this.options.mandatory&&("standalone"in t.navigator||this.options.debug),this.options.modal=this.options.modal||this.options.mandatory,this.options.mandatory&&(this.options.startDelay=-.5),this.options.detectHomescreen=this.options.detectHomescreen===!0?"hash":this.options.detectHomescreen,this.options.debug&&(s.isCompatible=!0,s.OS="string"==typeof this.options.debug?this.options.debug:"unsupported"==s.OS?"android":s.OS,s.OSVersion="ios"==s.OS?"7":"4"),this.container=e.documentElement,this.session=JSON.parse(localStorage.getItem(this.options.appID)),!s.hasToken||s.isCompatible&&this.session||(s.hasToken=!1,n()),s.isCompatible){this.session=this.session||m
try{localStorage.setItem(this.options.appID,JSON.stringify(this.session)),s.hasLocalStorage=!0}catch(a){s.hasLocalStorage=!1,this.options.onPrivate&&this.options.onPrivate.call(this)}for(var r=!this.options.validLocation.length,h=this.options.validLocation.length;h--;)if(this.options.validLocation[h].test(e.location.href)){r=!0
break}if(localStorage.getItem("addToHome")&&this.optOut(),!this.session.optedout&&!this.session.added&&r){if(s.isStandalone)return void(this.session.added||(this.session.added=!0,this.updateSession(),this.options.onAdd&&s.hasLocalStorage&&this.options.onAdd.call(this)))
if(this.options.detectHomescreen){if(s.hasToken)return n(),void(this.session.added||(this.session.added=!0,this.updateSession(),this.options.onAdd&&s.hasLocalStorage&&this.options.onAdd.call(this)))
"hash"==this.options.detectHomescreen?history.replaceState("",t.document.title,e.location.href+"#ath"):"smartURL"==this.options.detectHomescreen?history.replaceState("",t.document.title,e.location.href.replace(/(\/)?$/,"/ath$1")):history.replaceState("",t.document.title,e.location.href+(e.location.search?"&":"?")+"ath=")}(this.session.returningVisitor||(this.session.returningVisitor=!0,this.updateSession(),!this.options.skipFirstVisit))&&s.hasLocalStorage&&(this.ready=!0,this.options.onInit&&this.options.onInit.call(this),this.options.autostart&&this.show())}}},s.Class.prototype={events:{load:"_delayedShow",error:"_delayedShow",orientationchange:"resize",resize:"resize",scroll:"resize",click:"remove",touchmove:"_preventDefault",transitionend:"_removeElements",webkitTransitionEnd:"_removeElements",MSTransitionEnd:"_removeElements"},handleEvent:function(t){var e=this.events[t.type]
e&&this[e](t)},show:function(i){if(this.options.autostart&&!a)return void setTimeout(this.show.bind(this),50)
if(!this.shown){var o=Date.now(),n=this.session.lastDisplayTime
if(i!==!0){if(!this.ready)return
if(o-n<6e4*this.options.displayPace)return
if(this.options.maxDisplayCount&&this.session.displayCount>=this.options.maxDisplayCount)return}this.shown=!0,this.session.lastDisplayTime=o,this.session.displayCount++,this.updateSession(),this.applicationIcon||("ios"==s.OS?this.applicationIcon=e.querySelector('head link[rel^=apple-touch-icon][sizes="152x152"],head link[rel^=apple-touch-icon][sizes="144x144"],head link[rel^=apple-touch-icon][sizes="120x120"],head link[rel^=apple-touch-icon][sizes="114x114"],head link[rel^=apple-touch-icon]'):this.applicationIcon=e.querySelector('head link[rel^="shortcut icon"][sizes="196x196"],head link[rel^=apple-touch-icon]'))
var r=""
r=this.options.message in s.intl?s.intl[this.options.message].message.replace("%action",s.intl[this.options.message].action[s.OS]):""!==this.options.message?this.options.message:s.intl[s.language].message.replace("%action",s.intl[s.language].action[s.OS]),r="<p>"+r.replace("%icon",'<span class="ath-action-icon">icon</span>')+"</p>",this.viewport=e.createElement("div"),this.viewport.className="ath-viewport",this.options.modal&&(this.viewport.className+=" ath-modal"),this.options.mandatory&&(this.viewport.className+=" ath-mandatory"),this.viewport.style.position="absolute",this.element=e.createElement("div"),this.element.className="ath-container ath-"+s.OS+" ath-"+s.OS+(s.OSVersion+"").substr(0,1)+" ath-"+(s.isTablet?"tablet":"phone"),this.element.style.cssText="-webkit-transition-property:-webkit-transform,opacity;-webkit-transition-duration:0;-webkit-transform:translate3d(0,0,0);transition-property:transform,opacity;transition-duration:0;transform:translate3d(0,0,0);-webkit-transition-timing-function:ease-out",this.element.style.webkitTransform="translate3d(0,-"+t.innerHeight+"px,0)",this.element.style.webkitTransitionDuration="0s",this.options.icon&&this.applicationIcon&&(this.element.className+=" ath-icon",this.img=e.createElement("img"),this.img.className="ath-application-icon",this.img.addEventListener("load",this,!1),this.img.addEventListener("error",this,!1),this.img.src=this.applicationIcon.href,this.element.appendChild(this.img)),this.element.innerHTML+=r,this.viewport.style.left="-99999em",this.viewport.appendChild(this.element),this.container.appendChild(this.viewport),this.img||this._delayedShow()}},_delayedShow:function(t){setTimeout(this._show.bind(this),1e3*this.options.startDelay+500)},_show:function(){var i=this
this.updateViewport(),t.addEventListener("resize",this,!1),t.addEventListener("scroll",this,!1),t.addEventListener("orientationchange",this,!1),this.options.modal&&e.addEventListener("touchmove",this,!0),this.options.mandatory||setTimeout(function(){i.element.addEventListener("click",i,!0)},1e3),setTimeout(function(){i.element.style.webkitTransform="translate3d(0,0,0)",i.element.style.webkitTransitionDuration="1.2s"},0),this.options.lifespan&&(this.removeTimer=setTimeout(this.remove.bind(this),1e3*this.options.lifespan)),this.options.onShow&&this.options.onShow.call(this)},remove:function(){clearTimeout(this.removeTimer),this.img&&(this.img.removeEventListener("load",this,!1),this.img.removeEventListener("error",this,!1)),t.removeEventListener("resize",this,!1),t.removeEventListener("scroll",this,!1),t.removeEventListener("orientationchange",this,!1),e.removeEventListener("touchmove",this,!0),this.element.removeEventListener("click",this,!0),this.element.addEventListener("transitionend",this,!1),this.element.addEventListener("webkitTransitionEnd",this,!1),this.element.addEventListener("MSTransitionEnd",this,!1),this.element.style.webkitTransitionDuration="0.3s",this.element.style.opacity="0"},_removeElements:function(){this.element.removeEventListener("transitionend",this,!1),this.element.removeEventListener("webkitTransitionEnd",this,!1),this.element.removeEventListener("MSTransitionEnd",this,!1),this.container.removeChild(this.viewport),this.shown=!1,this.options.onRemove&&this.options.onRemove.call(this)},updateViewport:function(){if(this.shown){this.viewport.style.width=t.innerWidth+"px",this.viewport.style.height=t.innerHeight+"px",this.viewport.style.left=t.scrollX+"px",this.viewport.style.top=t.scrollY+"px"
var i=e.documentElement.clientWidth
this.orientation=i>e.documentElement.clientHeight?"landscape":"portrait"
var o="ios"==s.OS?"portrait"==this.orientation?screen.width:screen.height:screen.width
this.scale=screen.width>i?1:o/t.innerWidth,this.element.style.fontSize=this.options.fontSize/this.scale+"px"}},resize:function(){clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(this.updateViewport.bind(this),100)},updateSession:function(){s.hasLocalStorage!==!1&&localStorage.setItem(this.options.appID,JSON.stringify(this.session))},clearSession:function(){this.session=m,this.updateSession()},optOut:function(){this.session.optedout=!0,this.updateSession()},optIn:function(){this.session.optedout=!1,this.updateSession()},clearDisplayCount:function(){this.session.displayCount=0,this.updateSession()},_preventDefault:function(t){t.preventDefault(),t.stopPropagation()}},t.addToHomescreen=s}(window,document)
